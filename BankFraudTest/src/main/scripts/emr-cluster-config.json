{
    "Name": "BankFraudDetection-EMR-Cluster",
    "ReleaseLabel": "emr-6.15.0",
    "Applications": [
        {
            "Name": "Spark"
        },
        {
            "Name": "Hadoop"
        },
        {
            "Name": "Hive"
        },
        {
            "Name": "Livy"
        },
        {
            "Name": "JupyterHub"
        }
    ],
    "Configurations": [
        {
            "Classification": "spark-defaults",
            "Properties": {
                "spark.executor.memory": "4g",
                "spark.executor.cores": "2",
                "spark.driver.memory": "2g",
                "spark.sql.adaptive.enabled": "true",
                "spark.serializer": "org.apache.spark.serializer.KryoSerializer",
                "spark.dynamicAllocation.enabled": "true",
                "spark.shuffle.service.enabled": "true"
            }
        },
        {
            "Classification": "spark-env",
            "Configurations": [
                {
                    "Classification": "export",
                    "Properties": {
                        "JAVA_HOME": "/usr/lib/jvm/java-11-amazon-corretto.x86_64",
                        "SPARK_DAEMON_MEMORY": "2g"
                    }
                }
            ]
        },
        {
            "Classification": "yarn-site",
            "Properties": {
                "yarn.nodemanager.resource.memory-mb": "16384",
                "yarn.scheduler.maximum-allocation-mb": "16384",
                "yarn.nodemanager.vmem-check-enabled": "false"
            }
        }
    ],
    "Instances": {
        "InstanceGroups": [
            {
                "Name": "Master",
                "Market": "ON_DEMAND",
                "InstanceRole": "MASTER",
                "InstanceType": "m5.xlarge",
                "InstanceCount": 1,
                "EbsConfiguration": {
                    "EbsBlockDeviceConfigs": [
                        {
                            "VolumeSpecification": {
                                "VolumeType": "gp3",
                                "SizeInGB": 100
                            },
                            "VolumesPerInstance": 1
                        }
                    ]
                }
            },
            {
                "Name": "Core",
                "Market": "ON_DEMAND",
                "InstanceRole": "CORE",
                "InstanceType": "m5.xlarge",
                "InstanceCount": 2,
                "EbsConfiguration": {
                    "EbsBlockDeviceConfigs": [
                        {
                            "VolumeSpecification": {
                                "VolumeType": "gp3",
                                "SizeInGB": 200
                            },
                            "VolumesPerInstance": 2
                        }
                    ]
                }
            },
            {
                "Name": "Task",
                "Market": "SPOT",
                "InstanceRole": "TASK",
                "InstanceType": "m5.xlarge",
                "InstanceCount": 3,
                "BidPrice": "0.10",
                "AutoScalingPolicy": {
                    "Constraints": {
                        "MinCapacity": 1,
                        "MaxCapacity": 10
                    },
                    "Rules": [
                        {
                            "Name": "ScaleOutOnYarnMemory",
                            "Description": "Scale out when YARN memory utilization > 75%",
                            "Action": {
                                "SimpleScalingPolicyConfiguration": {
                                    "AdjustmentType": "CHANGE_IN_CAPACITY",
                                    "ScalingAdjustment": 2,
                                    "CoolDown": 300
                                }
                            },
                            "Trigger": {
                                "CloudWatchAlarmDefinition": {
                                    "ComparisonOperator": "GREATER_THAN",
                                    "EvaluationPeriods": 2,
                                    "MetricName": "YARNMemoryAvailablePercentage",
                                    "Namespace": "AWS/ElasticMapReduce",
                                    "Period": 300,
                                    "Statistic": "AVERAGE",
                                    "Threshold": 75.0,
                                    "Unit": "PERCENT"
                                }
                            }
                        },
                        {
                            "Name": "ScaleInOnYarnMemory",
                            "Description": "Scale in when YARN memory utilization < 25%",
                            "Action": {
                                "SimpleScalingPolicyConfiguration": {
                                    "AdjustmentType": "CHANGE_IN_CAPACITY",
                                    "ScalingAdjustment": -1,
                                    "CoolDown": 300
                                }
                            },
                            "Trigger": {
                                "CloudWatchAlarmDefinition": {
                                    "ComparisonOperator": "LESS_THAN",
                                    "EvaluationPeriods": 2,
                                    "MetricName": "YARNMemoryAvailablePercentage",
                                    "Namespace": "AWS/ElasticMapReduce",
                                    "Period": 300,
                                    "Statistic": "AVERAGE",
                                    "Threshold": 25.0,
                                    "Unit": "PERCENT"
                                }
                            }
                        }
                    ]
                }
            }
        ],
        "Ec2KeyName": "your-key-pair",
        "KeepJobFlowAliveWhenNoSteps": true,
        "TerminationProtected": false,
        "Ec2SubnetId": "subnet-xxxxxxxx"
    },
    "BootstrapActions": [
        {
            "Name": "Install Custom Dependencies",
            "ScriptBootstrapAction": {
                "Path": "s3://bank-fraud-data/scripts/emr-bootstrap.sh"
            }
        }
    ],
    "LogUri": "s3://bank-fraud-data/emr-logs/",
    "ServiceRole": "EMR_DefaultRole",
    "JobFlowRole": "EMR_EC2_DefaultRole",
    "VisibleToAllUsers": true,
    "Tags": [
        {
            "Key": "Project",
            "Value": "BankFraudDetection"
        },
        {
            "Key": "Environment",
            "Value": "Production"
        },
        {
            "Key": "ManagedBy",
            "Value": "DataPlatformTeam"
        }
    ],
    "ScaleDownBehavior": "TERMINATE_AT_TASK_COMPLETION",
    "StepConcurrencyLevel": 5
}